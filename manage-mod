#!/usr/bin/env perl

## no critic

use strict;
use warnings;

BEGIN {
  use FindBin qw( $RealBin $RealScript );
  use File::Basename;

  $ENV{MANAGE_MOD_VERSION}  = '0.01';
  $ENV{MANAGE_MOD_BASENAME} = basename( $RealScript );
  $ENV{MANAGE_MOD_CACHE_DIR} //= "$ENV{HOME}/.cache/$ENV{MANAGE_MOD_BASENAME}";
  $ENV{MANAGE_MOD_AGENT}     //= "HarleyPig's Mod Manager/$ENV{MANAGE_MOD_VERSION}";

  [ [ -d $ENV{MANAGE_MOD_CACHE_DIR} ] ]
    or mkdir $ENV{MANAGE_MOD_CACHE_DIR}
    or die "Unable to create cache dir.";
}

use lib "$RealBin/lib";

use Log::Any::Adapter;
use ManageMod::CurseForge;

#-----------------------------------------------------------------------------
#Log::Any::Adapter->set( 'File', "$HOME/.local/$ENV{BASENAME}" );
Log::Any::Adapter->set( 'File', "$ENV{MANAGE_MOD_BASENAME}.log", log_level => 'debug' );

#-----------------------------------------------------------------------------
my $mod      = 'streams';
my $version  = '1.12.2';
my $channels = 'release,beta';

my $data = get_mod_data( $mod, $version, $channels );

# Need to loop through dependencies.
# for my $depmod ( @{ $data->{dependencies} } ) {
#   get_mod( $depmod, $version, $channels );
# }

my @main = qw(
  categories dependencies description donate game id last_fetch license links
  shortname title type updated url
);

my $newdata = {};

$newdata->{$_} = $data->{$_} for @main;
$newdata->{"$version - $data->{channels}"} = $data->{download};

use YAML::Syck;
DumpFile( './dump.yaml', $newdata );
